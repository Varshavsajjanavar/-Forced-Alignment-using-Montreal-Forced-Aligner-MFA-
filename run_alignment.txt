# Environment setup
conda create -n mfa python=3.9
conda activate mfa
conda install -c conda-forge montreal-forced-aligner

# Check installation
mfa version

# Download models
mfa model download acoustic english_us_arpa
mfa model download dictionary english_us_arpa

# Prepare corpus (wav + txt in same folder)
mfa validate corpus english_us_arpa

# First alignment
mfa align corpus english_us_arpa english_us_arpa aligned --clean --verbose

# Find OOVs
# (generated automatically as oovs_found_english_us_arpa.txt)

# Download G2P model
mfa models download g2p english_us_arpa

# Generate pronunciations for OOV words
mfa g2p oovs_found_english_us_arpa.txt english_us_arpa generated.dict

# Merge dictionaries
type english_us_arpa.dict generated.dict > english_us_arpa_fixed.dict

# Re-align with fixed dictionary
mfa align corpus english_us_arpa_fixed.dict english_us_arpa aligned_fixed --clean --verbose
